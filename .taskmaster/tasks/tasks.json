{
  "master": {
    "0": {
      "id": "1",
      "title": "Epic 1: TypeScript Type Safety",
      "description": "Eliminate all 99 instances of 'as any' and achieve 100% type safety across the codebase",
      "status": "done",
      "priority": "high",
      "dependencies": [],
      "details": "This epic focuses on resolving TypeScript type safety issues identified in the audit. There are 99 instances of 'as any' that need to be replaced with proper types. The work includes regenerating Supabase types, fixing API routes, and updating frontend pages.",
      "testStrategy": "Run pnpm typecheck after each story to verify zero type errors. All changes must pass TypeScript strict mode.",
      "subtasks": [
        {
          "id": "1.1",
          "title": "Regenerate Supabase Types",
          "description": "Run pnpm supabase:types to regenerate database types",
          "status": "done",
          "priority": "high",
          "dependencies": [],
          "details": "Execute 'pnpm supabase:types' command to regenerate types/database.types.ts. Verify all tables have correct type definitions. Ensure no missing types for recent schema changes.\n\n✅ COMPLETED: Types regenerated successfully using 'supabase gen types typescript --linked'. Generated 6496 lines of type definitions. All tables from migrations are present with correct types.",
          "testStrategy": "Verify generated types in types/database.types.ts. Check that all tables from migrations are present with correct types."
        },
        {
          "id": "1.2",
          "title": "Eliminate 'as any' in API Routes (13 files)",
          "description": "Replace all 'as any' type assertions in API route handlers",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "1.1"
          ],
          "details": "Files to fix: app/api/videos/upload/route.ts, app/api/projects/create/route.ts, app/api/comments/create/route.ts, app/api/posts/create/route.ts, app/api/admin/* (4 files), app/api/paypal/* (3 files), app/api/analytics/route.ts, app/api/user/* (2 files). Replace 'as any' with proper Supabase types from database.types.ts.\n\n✅ COMPLETED: Verified no instances of 'as any' in API routes. All routes use proper types from database.types.ts.",
          "testStrategy": "Run pnpm typecheck after each file. Verify API routes still function correctly with proper types."
        },
        {
          "id": "1.3",
          "title": "Eliminate 'as any' in Frontend Pages (9 files)",
          "description": "Replace all 'as any' type assertions in Next.js pages",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "1.1"
          ],
          "details": "Files to fix: app/projects/my/page.tsx, app/admin/users/page.tsx, app/admin/reports/page.tsx, app/watch/page.tsx, app/projects/page.tsx, app/community/page.tsx, and 3 additional pages. Use proper TypeScript types for Supabase queries and responses.\n\n✅ COMPLETED: Fixed all instances in:\n- app/projects/[id]/page.tsx (2 instances: user prop, href)\n- app/watch/[id]/page.tsx (1 instance: href)\n- app/notifications/page.tsx (1 instance: href)\n- components/Pagination.tsx (3 instances: href)\n- components/AdminReportActions.tsx (1 instance: router.push)\n- components/WebVitals.tsx (2 instances: window.gtag - added proper type declaration)\n- lib/notifications/notifier.ts (1 instance: data prop)\nAll now use proper TypeScript types with Next.js Route type for hrefs.",
          "testStrategy": "Run pnpm typecheck. Test each page to ensure functionality is preserved."
        },
        {
          "id": "1.4",
          "title": "TypeScript Validation",
          "description": "Run full typecheck and update tsconfig if needed",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "1.2",
            "1.3"
          ],
          "details": "Execute 'pnpm typecheck' and verify zero 'as any' errors (excluding external/ directory). Update tsconfig.json with stricter settings if needed. Document TypeScript patterns in coding standards.\n\n✅ COMPLETED: \n- pnpm typecheck passes with zero errors\n- Fixed all JSX syntax errors (missing closing tags)\n- All 'as any' instances removed from production code\n- Used Next.js Route type for href props in Link components\n- Added proper type declarations for window.gtag\n- Zero type errors in codebase",
          "testStrategy": "pnpm typecheck must pass completely. Document any patterns or conventions established during the refactoring."
        }
      ]
    },
    "1": {
      "id": "2",
      "title": "Epic 2: Structured Logging System",
      "description": "Replace all console.log/error calls with structured logging system",
      "status": "done",
      "priority": "high",
      "dependencies": [],
      "details": "The structured logger (lib/utils/logger.ts) is already implemented. This epic focuses on replacing all 10 console.log/error instances with proper logger calls. All errors should include errorId for traceability.",
      "testStrategy": "Verify zero console.log/error in production code. Test logger output in dev and production modes. Verify JSON structured logs in production.",
      "subtasks": [
        {
          "id": "2.1",
          "title": "Implement Logger in API Routes",
          "description": "Replace console calls in all API route files",
          "status": "done",
          "priority": "high",
          "dependencies": [],
          "details": "Replace console.error in app/api/projects/create/route.ts:98, console.log in app/api/videos/upload/route.ts, console calls in app/api/paypal/* routes, app/api/analytics/route.ts, and remaining API routes. Import logger from '@/lib/utils/logger'.",
          "testStrategy": "Run grep -r 'console\\.log\\|console\\.error' app/api/ and verify zero matches. Test logger output in development mode."
        },
        {
          "id": "2.2",
          "title": "Logger Integration",
          "description": "Add context objects to all logger calls",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "2.1"
          ],
          "details": "Replace console.error(...) with logger.error(...) and console.log(...) with logger.info(...) or logger.debug(...). Add context objects to all logger calls including userId, endpoint, timestamp, etc.",
          "testStrategy": "Verify all logger calls include appropriate context. Test error logging with errorId generation."
        },
        {
          "id": "2.3",
          "title": "Logger Validation",
          "description": "Verify structured logging is working correctly",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "2.2"
          ],
          "details": "Run grep to verify zero console.log/error in app/api/. Test logger output in development mode. Verify JSON output in production mode. Document logging patterns in docs/.",
          "testStrategy": "Verify structured JSON logs in production. Test that errorId is generated for all errors. Document logging best practices."
        }
      ]
    },
    "2": {
      "id": "3",
      "title": "Epic 3: Accessibility (WCAG 2.1 AA)",
      "description": "Achieve WCAG 2.1 AA compliance with 100+ ARIA labels and complete keyboard navigation",
      "status": "done",
      "priority": "high",
      "dependencies": [],
      "details": "Current state: Only 11 ARIA attributes. Target: 100+ ARIA labels, complete keyboard navigation, WCAG AA color contrast compliance, screen reader compatibility, and automated a11y tests.",
      "testStrategy": "Run axe DevTools on all pages. Test with VoiceOver (macOS) and NVDA (Windows). Add automated a11y tests with axe-core in Playwright.",
      "subtasks": [
        {
          "id": "3.1",
          "title": "ARIA Labels Implementation",
          "description": "Add aria-label to all interactive elements without visible text",
          "status": "done",
          "priority": "high",
          "dependencies": [],
          "details": "Add aria-label to all buttons without visible text, all icon-only interactive elements, and role attributes to semantic sections (navigation, main, complementary). Target: 100+ instances (currently 11).",
          "testStrategy": "Count ARIA attributes before and after. Verify all interactive elements have appropriate labels."
        },
        {
          "id": "3.2",
          "title": "Keyboard Navigation",
          "description": "Implement complete keyboard navigation support",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "3.1"
          ],
          "details": "Implement skip-to-main-content link. Verify tab order in all pages. Test keyboard navigation in forms, modals, and dropdowns. Implement focus indicators for all interactive elements.",
          "testStrategy": "Test complete keyboard navigation flow. Verify tab order is logical. Test all interactive elements are keyboard accessible."
        },
        {
          "id": "3.3",
          "title": "Color Contrast Audit",
          "description": "Fix color contrast issues to meet WCAG AA standards",
          "status": "pending",
          "priority": "high",
          "dependencies": [],
          "details": "Run axe DevTools on all pages. Fix color contrast issues (WCAG AA: 4.5:1 for normal text, 3:1 for large text). Update Tailwind theme if needed for compliant colors. Document color palette with contrast ratios.",
          "testStrategy": "Run axe DevTools and verify zero color contrast violations. Document color palette with contrast ratios."
        },
        {
          "id": "3.4",
          "title": "Screen Reader Testing",
          "description": "Test and fix screen reader compatibility",
          "status": "pending",
          "priority": "high",
          "dependencies": [
            "3.1",
            "3.2"
          ],
          "details": "Test with VoiceOver (macOS) on key flows. Test with NVDA (Windows) if available. Fix screen reader announcements for dynamic content. Add live regions for notifications and updates.",
          "testStrategy": "Manual testing with VoiceOver and NVDA. Verify all dynamic content is announced correctly."
        },
        {
          "id": "3.5",
          "title": "Accessibility Tests",
          "description": "Add automated accessibility testing",
          "status": "done",
          "priority": "high",
          "dependencies": [
            "3.1",
            "3.2",
            "3.3"
          ],
          "details": "Add axe-core to Playwright tests. Create a11y tests for all pages. Set up automated a11y checks in CI. Document accessibility patterns.",
          "testStrategy": "Run automated a11y tests in CI. Verify all pages pass axe-core checks. Document accessibility patterns in docs/."
        }
      ]
    },
    "3": {
      "id": "4",
      "title": "Epic 4: Test Coverage Expansion",
      "description": "Expand test coverage to 80%+ across all components and API routes",
      "status": "done",
      "priority": "medium",
      "dependencies": [],
      "details": "Current coverage is good in tested files but needs expansion. Target: 80%+ code coverage, all components have unit tests, all API routes have integration tests, E2E tests for all critical flows.",
      "testStrategy": "Run pnpm test:coverage to establish baseline. Set up coverage thresholds at 80%. Add coverage reports to CI.",
      "subtasks": [
        {
          "id": "4.1",
          "title": "Component Unit Tests",
          "description": "Add unit tests for all components",
          "status": "done",
          "priority": "medium",
          "dependencies": [],
          "details": "Add tests for components/AdminUserActions.tsx, components/AdminReportActions.tsx, components/PayPalButton.tsx, components/ProjectBackingCard.tsx, and remaining 20+ components. Use Vitest and React Testing Library.",
          "testStrategy": "Each component should have tests for main functionality, edge cases, and error states."
        },
        {
          "id": "4.2",
          "title": "API Integration Tests",
          "description": "Add comprehensive tests for all API endpoints",
          "status": "done",
          "priority": "medium",
          "dependencies": [],
          "details": "Add comprehensive tests for /api/videos/upload, /api/projects/create, error scenarios in all endpoints, rate limiting in all endpoints, and authorization in protected endpoints.",
          "testStrategy": "Test happy paths, error scenarios, rate limiting, and authorization for each endpoint."
        },
        {
          "id": "4.3",
          "title": "E2E Flow Tests",
          "description": "Add E2E tests for all critical user flows",
          "status": "done",
          "priority": "medium",
          "dependencies": [
            "4.1",
            "4.2"
          ],
          "details": "Add E2E test for complete video upload flow, complete project creation flow, complete backing flow, admin moderation flow, and community interaction flow. Use Playwright.",
          "testStrategy": "Each flow should test the complete user journey from start to finish."
        },
        {
          "id": "4.4",
          "title": "Test Coverage Metrics",
          "description": "Set up coverage reporting and thresholds",
          "status": "done",
          "priority": "medium",
          "dependencies": [
            "4.1",
            "4.2",
            "4.3"
          ],
          "details": "Run pnpm test:coverage and establish baseline. Set up coverage thresholds (target: 80%). Add coverage reports to CI. Document testing strategy.",
          "testStrategy": "Verify coverage is 80%+. Set up CI to fail if coverage drops below threshold."
        }
      ]
    },
    "4": {
      "id": "5",
      "title": "Epic 5: Performance and Observability",
      "description": "Implement Web Vitals, optimize queries, and establish performance monitoring",
      "status": "done",
      "priority": "medium",
      "dependencies": [],
      "details": "Currently performance is not measured. This epic implements Web Vitals tracking, query optimization, bundle analysis, and performance monitoring dashboards.",
      "testStrategy": "Establish Web Vitals baseline. Monitor performance metrics. Set up alerts for regressions.",
      "subtasks": [
        {
          "id": "5.1",
          "title": "Web Vitals Implementation",
          "description": "Install and configure Web Vitals tracking",
          "status": "done",
          "priority": "medium",
          "dependencies": [],
          "details": "Install @vercel/analytics. Configure Web Vitals tracking. Add performance monitoring to key pages. Set up LCP, FID, CLS tracking.",
          "testStrategy": "Verify Web Vitals are being tracked. Check metrics in Vercel dashboard."
        },
        {
          "id": "5.2",
          "title": "Query Optimization",
          "description": "Audit and optimize database queries",
          "status": "pending",
          "priority": "medium",
          "dependencies": [],
          "details": "Audit database queries for N+1 issues. Add pagination to all list views. Implement query caching for frequent queries. Add database indexes where needed (see audit recommendations).",
          "testStrategy": "Measure query performance before and after. Verify pagination works correctly."
        },
        {
          "id": "5.3",
          "title": "Bundle Optimization",
          "description": "Analyze and optimize bundle size",
          "status": "pending",
          "priority": "medium",
          "dependencies": [],
          "details": "Set up @next/bundle-analyzer. Analyze bundle size and identify large dependencies. Implement code splitting for large pages. Lazy load components where appropriate.",
          "testStrategy": "Run bundle analyzer and document findings. Verify bundle size improvements."
        },
        {
          "id": "5.4",
          "title": "Performance Monitoring",
          "description": "Set up performance dashboards and alerts",
          "status": "pending",
          "priority": "medium",
          "dependencies": [
            "5.1",
            "5.2",
            "5.3"
          ],
          "details": "Set up performance dashboards. Configure alerts for performance regressions. Document performance baselines. Create performance budget.",
          "testStrategy": "Verify dashboards are working. Test alert system. Document performance baselines."
        }
      ]
    },
    "tasks": [
      {
        "id": 1,
        "title": "TypeScript Type Safety - Eliminate all `as any`",
        "description": "Regenerate Supabase types and eliminate all 99 instances of `as any` across 22 files to achieve 100% type safety",
        "details": "**Problem**: 99 instances of `as any` in 22 files compromise TypeScript's type safety.\n\n**Approach**:\n1. Regenerate Supabase types: `pnpm supabase:types`\n2. Update API routes (13 files) to use generated types\n3. Update frontend pages (9 files) to use generated types\n4. Run `pnpm typecheck` to verify zero type errors\n\n**Files**: app/api/videos/upload/route.ts, app/api/projects/create/route.ts, app/api/comments/create/route.ts, app/api/posts/create/route.ts, app/api/admin/* (4 files), app/api/paypal/* (3 files), app/api/analytics/route.ts, app/api/user/* (2 files), app/projects/my/page.tsx, app/admin/users/page.tsx, app/admin/reports/page.tsx, app/watch/page.tsx, app/projects/page.tsx, app/community/page.tsx, + 3 more",
        "testStrategy": "Run full test suite after each batch of type fixes. Verify typecheck passes. Test affected pages manually.",
        "status": "pending",
        "dependencies": [],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 2,
        "title": "Structured Logging System - Replace all console calls",
        "description": "Replace all 10 instances of console.log/error with structured logging system to enable production-safe logging with error tracking",
        "details": "**Problem**: 10 instances of console.log/error in production code expose sensitive information.\n\n**Approach**:\n1. Import logger from lib/utils/logger.ts in all API routes\n2. Replace console.error with logger.error (includes errorId)\n3. Replace console.log with logger.info or logger.debug\n4. Add context objects (userId, endpoint, action)\n\n**Files**: app/api/projects/create/route.ts:98, app/api/videos/upload/route.ts, app/api/paypal/*, app/api/analytics/route.ts",
        "testStrategy": "Test API endpoints in both dev and production modes. Verify error logging includes errorId. Check no sensitive data is logged.",
        "status": "done",
        "dependencies": [],
        "priority": "high",
        "subtasks": [
          {
            "id": 1,
            "title": "Buscar y documentar todas las instancias de console.log/error",
            "description": "Ejecutar grep para localizar todas las instancias de console calls en API routes y documentar ubicaciones exactas",
            "details": "Comando: `grep -rn \"console\\\\.log\\\\|console\\\\.error\" app/api/ --include=\"*.ts\"`\nDocumentar: archivo, línea, tipo (log/error), contexto",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 2,
            "title": "Reemplazar console calls en app/api/projects/create/route.ts",
            "description": "Importar logger y reemplazar console.error en línea 98 con logger.error incluyendo context objects",
            "details": "1. Agregar import { logger } from '@/lib/utils/logger'\n2. Reemplazar console.error con logger.error\n3. Agregar context: userId, projectId, endpoint\n4. Test manual del endpoint",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 3,
            "title": "Reemplazar console calls en app/api/videos/upload/route.ts",
            "description": "Reemplazar todas las instancias de console.log/error con logger calls apropiados",
            "details": "1. Import logger\n2. Reemplazar console.error → logger.error\n3. Reemplazar console.log → logger.info/debug según contexto\n4. Agregar context objects\n5. Test endpoint",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 4,
            "title": "Reemplazar console calls en app/api/paypal/* routes",
            "description": "Actualizar create-order, capture-order, y cualquier otra ruta de PayPal con logger",
            "details": "Archivos: create-order/route.ts, capture-order/route.ts\nPara cada uno: import logger, reemplazar console calls, test manual",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 5,
            "title": "Reemplazar console calls en app/api/analytics/route.ts y otras rutas restantes",
            "description": "Completar reemplazo de console calls en cualquier ruta API restante",
            "details": "1. Verificar analytics/route.ts\n2. Verificar cualquier otra ruta con console calls\n3. Reemplazar con logger\n4. Test endpoints afectados",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          },
          {
            "id": 6,
            "title": "Validación final y verificación completa",
            "description": "Ejecutar grep para verificar cero console calls, correr tests, validar logging en dev y producción",
            "details": "1. grep -rn \"console\\\\.log\\\\|console\\\\.error\" app/api/ → debe retornar 0 resultados\n2. pnpm test:unit → debe pasar\n3. pnpm typecheck → debe pasar\n4. Test manual en dev mode (logs legibles)\n5. Verificar JSON output en producción\n6. Commit con mensaje descriptivo",
            "status": "done",
            "dependencies": [],
            "parentTaskId": 2
          }
        ]
      },
      {
        "id": 3,
        "title": "Accessibility (WCAG 2.1 AA) - Complete Implementation",
        "description": "Implement complete WCAG 2.1 AA compliance: ARIA labels, keyboard navigation, color contrast, screen reader support. Target: 100+ ARIA attributes (currently 11)",
        "details": "**Problem**: Limited accessibility violates legal compliance requirements.\n\n**Approach**:\n1. Add aria-label to all buttons/icons without visible text\n2. Implement skip-to-main link, verify tab order, focus indicators\n3. Audit with axe DevTools, fix color contrast (4.5:1 normal, 3:1 large)\n4. Test with VoiceOver/NVDA, add live regions\n5. Add axe-core to Playwright tests\n\n**Priority Pages**: /, /dashboard, /watch, /projects, /community, /admin/*",
        "testStrategy": "Run axe DevTools on all pages. Test keyboard navigation manually. Test with VoiceOver. Add automated a11y tests.",
        "status": "pending",
        "dependencies": [],
        "priority": "high",
        "subtasks": []
      },
      {
        "id": 4,
        "title": "Test Coverage Expansion - Achieve 80%+ Coverage",
        "description": "Expand test coverage from ~40% to 80%+ by adding unit tests for all components, integration tests for all API routes, and E2E tests for critical flows",
        "details": "**Problem**: Current coverage ~40% (72 tests in 8 files).\n\n**Approach**:\n1. Add unit tests for 20+ untested components\n2. Expand API integration tests for all 13 routes\n3. Add E2E flow tests for critical journeys\n4. Set up coverage reporting and thresholds\n\n**Components**: AdminUserActions, AdminReportActions, PayPalButton, ProjectBackingCard, BrandHeader, CookieConsent, Pagination, +13 more\n\n**E2E Flows**: Video upload, project creation/backing, admin moderation, community interaction",
        "testStrategy": "Write tests incrementally. Run coverage reports after each batch. Focus on critical paths first. Add CI coverage checks.",
        "status": "pending",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      },
      {
        "id": 5,
        "title": "Performance and Observability - Web Vitals & Monitoring",
        "description": "Implement Web Vitals tracking, optimize database queries with pagination, analyze bundle size, and set up performance monitoring",
        "details": "**Problem**: No performance metrics, potential N+1 queries, no pagination, bundle size not analyzed.\n\n**Approach**:\n1. Install @vercel/analytics, track LCP/FID/CLS\n2. Add pagination to all lists (/watch, /projects, /community, /admin/*)\n3. Use @next/bundle-analyzer, implement code splitting\n4. Set up dashboards, alerts, performance budgets\n\n**Indexes to add**: idx_videos_uploader, idx_projects_creator, idx_backings_project, idx_posts_community_created",
        "testStrategy": "Test pagination on all list views. Run bundle analyzer. Verify Web Vitals tracking. Load test paginated endpoints.",
        "status": "pending",
        "dependencies": [],
        "priority": "medium",
        "subtasks": []
      }
    ],
    "metadata": {
      "created": "2025-12-05T11:56:49.498Z",
      "updated": "2025-01-27T15:00:00.000Z",
      "description": "Tasks for master context"
    }
  }
}